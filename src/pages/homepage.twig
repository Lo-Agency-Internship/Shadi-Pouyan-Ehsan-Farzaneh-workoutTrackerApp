{% extends "./layouts/main.twig" %}
{% import "./macros/card.twig" as card %}
{% block scripts %}
	<script>
	
	let exercises = {{exercises}}
	console.log({exercises})
	let filteredExercises = []
	
	function filterDays(askedDay) {
		filteredExercises = []

		let today = new Date();
		
		let dd = String(today.getDate()).padStart(2, "0");

		let prevDay = String(Number(dd) - 1);

		let nextDay = String(Number(dd) + 1);

		let mm = String(today.getMonth() + 1).padStart(2, "0");

		let yyyy = String(today.getFullYear());

		const yesterdayDate = [yyyy, mm, prevDay];
		const todayDate = [yyyy, mm, dd];
		const tomorrowDate = [yyyy, mm, nextDay];

		const userId = document.cookie.split("=")[1];

		let filteration = exercises.filter(function (item) {
			let exerciseDate = item.date.split("-");
			switch (String(askedDay)) {
			case "1":
			console.log("chera")
				if (JSON.stringify(exerciseDate) == JSON.stringify(yesterdayDate)) {
				filteredExercises.push(item);
				}
				break;

			case "2":
				if (JSON.stringify(exerciseDate) == JSON.stringify(todayDate)) {
				filteredExercises.push(item);
				}
				break;

			case "3":
				if (JSON.stringify(exerciseDate) == JSON.stringify(tomorrowDate)) {
				filteredExercises.push(item);
				}
				break;

			default:
				break;
			}
		
		});
			const cardsWrapper = document.querySelector(".changer")
				cardsWrapper.innerHTML = "";
				filteredExercises.map(item => {
					cardsWrapper.innerHTML += `
					<div class="container d-flex" style="flex-wrap: wrap ; width: 100vw; justify-content: space-between">
							<div style="flex-basis: 45%; margin: 0.5rem 0">
								<form action="/homepage/delete" method="post">
									<div class="fluid rounded-start">
										<div class="card  align-self-center " style="background-color: #d8f0f5fa">
											<div class="card-body ">
												<h5 class="card-title">Exercise</h5>
											</div>
											<ul class="list-group list-group-flush">
												<strong>Main Task:</strong>&nbsp<li class="list-group-item" >${item.taskName}</li>
												<strong> SubTask:</strong>&nbsp <li class="list-group-item" >${item.subTaskName}</li>
												<strong>Number of rounds:</strong>&nbsp <li class="list-group-item">${item.roundRange}</li>
												<strong>Time of each round:</strong>&nbsp <li class="list-group-item">${item.timeRange}</li>
												<strong>Description:</strong>&nbsp<li class="list-group-item">${item.description}</li>
												<strong>Date:</strong>&nbsp<li class="list-group-item">${item.date}</li>
											</ul>
											<input name="exerciseID" value="${item.id}" type="hidden"></input>
											<button class="btn bg-danger" onclick="return confirm('Are you sure you want to delete this exercise?');" type="submit"> Delete </button>
										</div>
									</div>
								</form>
							</div>
						</div>
					 `
				})

	}
	
	console.log(filteredExercises)
	console.log("new filtered exercises")
	console.log("ebiroon",exercises)

	</script>
{% endblock %}
{% block content %}
	<main
		data-bs-spy="scroll" data-bs-target="#navbar-example">
		<!-- main page -->
		<div class="d-flex flex-row width-100">
			<div class="flex">
				<h1>{{userId}}</h1>
				<button class="btn btn-primary btn btn-info d-flex my-5" type="button" onclick="filterDays(1)">
					Yesterday
				</button>
				<button class="btn btn-primary btn btn-info d-flex my-5" type="button" onclick="filterDays(2)">
					Today
				</button>
				<button class="btn btn-primary btn btn-info d-flex my-5" type="button" onclick="filterDays(3)">
					Tomorrow
				</button>
				<div id="test"></div>
			</div>
		</div>
	</main>

<div class="changer">
	<div x-data="{ exercises : exercises }">
		<div class="container d-flex" style="flex-wrap: wrap ; width: 100vw; justify-content: space-between">
			<template x-for="exercise in exercises">
				<div style="flex-basis: 45%; margin: 0.5rem 0">
					<form action="/homepage/delete" method="post">
						<div class="fluid rounded-start">
							<div class="card  align-self-center " style="background-color: #d8f0f5fa">
								<div class="card-body ">
									<h5 class="card-title">Exercise</h5>
								</div>
								<ul class="list-group list-group-flush">
									<strong>Main Task:</strong>&nbsp<li class="list-group-item" x-text="exercise.taskName"></li>
									<strong> SubTask:</strong>&nbsp <li class="list-group-item" x-text="exercise.subTaskName"></li>
									<strong>Number of rounds:</strong>&nbsp <li class="list-group-item" x-text="exercise.roundRange"></li>
									<strong>Time of each round:</strong>&nbsp <li class="list-group-item" x-text="exercise.timeRange"></li>
									<strong>Description:</strong>&nbsp<li class="list-group-item" x-text="exercise.description"></li>
									<strong>Date:</strong>&nbsp<li class="list-group-item" x-text="exercise.date"></li>
								</ul>
								<input name="exerciseID" x-bind:exercises="exercise.id" type="hidden" x-model="exercise.id"></input>
								<button class="btn bg-danger" onclick="return confirm('Are you sure you want to delete this exercise?');" type="submit"> Delete </button>
							</div>
						</div>
					</form>
				</div>
			</template>
		</div>
	</div>
</div>


{% endblock %}
